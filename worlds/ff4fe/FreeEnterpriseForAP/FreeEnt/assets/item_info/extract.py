WEAPONS = '''         
[claw]FireClaw
[claw]IceClaw 
[claw]Thunder 
[claw]Charm   
[claw]Poison  
[claw]CatClaw 
[rod]Rod     
[rod]IceRod  
[rod]FlameRod
[rod]Thunder 
[rod]Change  
[rod]Charm   
[rod]Stardust
[rod]Lilith  
[staff]Staff   
[staff]Cure    
[staff]Silver  
[staff]Power   
[staff]Lunar   
[staff]Life    
[staff]Silence 
[darksword]Shadow  
[darksword]Darkness
[darksword]Black   
[lightsword]Legend  
[lightsword]Light   
[lightsword]Excalbur
[sword]Fire    
[sword]IceBrand
[sword]Defense 
[sword]Drain   
[sword]Ancient 
[sword]Slumber 
[sword]Medusa  
[spear]Spear   
[spear]Wind    
[spear]Flame   
[spear]Blizzard
[spear]Dragoon 
[spear]White   
[spear]Drain   
[spear]Gungnir 
[katana]Short   
[katana]Middle  
[katana]Long    
[katana]Ninja   
[katana]Murasame
[katana]Masamune
[knife]Assassin
[knife]Mute    
[whip]Whip    
[whip]Chain   
[whip]Blitz   
[whip]Flame   
[whip]Dragon  
[axe]HandAxe 
[axe]Dwarf   
[axe]Ogre    
[knife]Silver  
[knife]Dancing 
[sword]Silver  
[knife]Spoon   
[lightsword]Crystal 
[shuriken]Shuriken
[shuriken]Ninja   
[boomerang]Boomrang
[boomerang]FullMoon
[harp]Dreamer 
[harp]Charm   
[$15]Dummy   
[axe]Poison  
[axe]RuneAxe 
[wrench]Silver  
[wrench]Earth   
[wrench]Wooden  
[sword]Avenger 
[bow]ShortBow
[bow]CrossBow
[bow]GreatBow
[bow]Archer  
[bow]ElvenBow
[bow]Samurai 
[bow]Artemis 
[arrow]Iron    
[arrow]White   
[arrow]Fire    
[arrow]Ice     
[arrow]Lit     
[arrow]Darkness
[arrow]Poison  
[arrow]Mute    
[arrow]Charm   
[arrow]Samurai 
[arrow]Medusa  
[arrow]Artemis 
'''.split()

ARMORS = '''
[shield]Iron    
[shield]Shadow  
[shield]Black   
[shield]Paladin 
[shield]Silver  
[shield]Fire    
[shield]Ice     
[shield]Diamond 
[shield]Aegis   
[shield]Samurai 
[shield]Dragoon 
[shield]Crystal 
[helmet]Iron    
[helmet]Shadow  
[helmet]Darkness
[helmet]Black   
[helmet]Paladin 
[helmet]Silver  
[helmet]Diamond 
[helmet]Samurai 
[helmet]Dragoon 
[helmet]Crystal 
[helmet]Cap     
[helmet]Leather 
[helmet]Gaea    
[helmet]Wizard  
[helmet]Tiara   
[helmet]Ribbon  
[helmet]Headband
[helmet]Bandanna
[helmet]Ninja   
[helmet]Glass   
[armor]Iron    
[armor]Shadow  
[armor]Darkness
[armor]Black   
[armor]Paladin 
[armor]Silver  
[armor]Fire    
[armor]Ice     
[armor]Diamond 
[armor]Samurai 
[armor]Dragoon 
[armor]Crystal 
[shirt]Cloth   
[shirt]Leather 
[shirt]Gaea    
[shirt]Wizard  
[shirt]Black   
[shirt]Sorcerer
[shirt]White   
[shirt]Power   
[shirt]Heroine 
[shirt]Prisoner
[shirt]Bard    
[shirt]Karate  
[shirt]Bl.Belt 
[armor]Adamant 
[shirt]Ninja   
[gauntlet]Iron    
[gauntlet]Shadow  
[gauntlet]Darkness
[gauntlet]Black   
[gauntlet]Paladin 
[gauntlet]Silver  
[gauntlet]Diamond 
[gauntlet]Zeus    
[gauntlet]Samurai 
[gauntlet]Dragoon 
[gauntlet]Crystal 
[ring]IronRing
[ring]RubyRing
[ring]Silver  
[ring]Strength
[ring]Rune    
[ring]Crystal 
[ring]Diamond 
[ring]Protect 
[ring]Cursed  
'''.split()

SPELLS = '''      
[whitemagic]Hold 
[whitemagic]Mute 
[whitemagic]Charm
[whitemagic]Blink
 Armor
 Shell
[whitemagic]Slow 
[whitemagic]Fast 
[whitemagic]Bersk
[whitemagic]Wall 
[whitemagic]White
[whitemagic]Dummy
[whitemagic]Peep 
[whitemagic]Cure1
[whitemagic]Cure2
[whitemagic]Cure3
[whitemagic]Cure4
[whitemagic]Heal 
[whitemagic]Life1
[whitemagic]Life2
[whitemagic]Size 
[whitemagic]Exit 
[whitemagic]Sight
[whitemagic]Float
[blackmagic]Toad 
[blackmagic]Piggy
[blackmagic]Warp 
[blackmagic]Venom
[blackmagic]Fire1
[blackmagic]Fire2
[blackmagic]Fire3
[blackmagic]Ice-1
[blackmagic]Ice-2
[blackmagic]Ice-3
[blackmagic]Lit-1
[blackmagic]Lit-2
[blackmagic]Lit-3
[blackmagic]Virus
[blackmagic]Weak 
[blackmagic]Quake
[blackmagic]Sleep
[blackmagic]Stone
[blackmagic]Fatal
[blackmagic]Stop 
[blackmagic]Drain
[blackmagic]Psych
[blackmagic]Meteo
[blackmagic]Nuke 
[callmagic]Imp  
[callmagic]Bomb 
[callmagic]Dummy
[callmagic]Mage 
[callmagic]Chocb
[callmagic]Shiva
[callmagic]Indra
[callmagic]Jinn 
[callmagic]Titan
[callmagic]Mist 
[callmagic]Sylph
[callmagic]Odin 
[callmagic]Levia
[callmagic]Asura
[callmagic]Baham
 Comet
 Flare
 Flame
 Flood
 Blitz
 Smoke
 Pin  
 Image
Dummy   
Dummy   
Dummy   
Dummy   
Dummy   
Imp     
Bomb    
Dummy   
Mage    
Chocobo 
Shiva   
Indra   
Jinn    
Titan   
Mist    
Sylph   
Odin    
Leviatan
Asura   
Asura   
Asura   
Bahamut 
W.Meteo 
Dummy   
Dummy   
Gaze    
Bluster 
Slap    
Powder  
Glance  
Charm   
Tongue  
Curse   
Ray     
Count   
Beak    
Petrify 
Blast   
Hug     
Breath  
Whisper 
Entangle
Weak    
Disrupt 
ColdMist
Explode 
DullSong
Hold Gas
Gas     
Poison  
Maser   
Vanish  
Demolish
Blk.Hole
Dancing 
Disrupt 
Storm   
Magnet  
Reaction
Hatch   
Remedy  
Absorb  
Heal    
Big Bang
Vampire 
Digest  
Pollen  
Crush   
Alert   
Call    
Dummy   
Vanish  
Search  
Fission 
Retreat 
Heal    
Beam    
Globe199
Fire    
Blaze   
Blitz   
Thunder 
D.Breath
Big Wave
Blizzard
Wave    
Tornado 
Laser   
Explode 
Quake   
Emission
Heat Ray
Glare   
Odin    
MegaNuke
Needle  
Counter 
Dummy   
Dummy   
Recover 
Remedy  
Dummy   
Dummy   
Dummy   
'''.strip().split('\n')

ELEMENTS = '''
Fire
Ice
Bolt
Dark
Holy
Air
Drain
Immune
Poison
Blind
Mute
Pig
Mini
Toad
Stone
Swoon
Calcify1
Calcify2
Berserk
Charm
Sleep
Stun
Float
Curse
'''.split()

RACES = '''
dragons
robots
reptiles
spirits
giants
slimes
mages
undead
'''.split()

JOBS = 'DKCecil Kain CRydia Tellah Edward Rosa Yang Palom Porom PCecil Cid ARydia Edge Fusoya'.split()

STATS = 'STR AGI VIT WIS WIL'.split()
STATS_MODS_FLAGGED = [3, 5, 10, 15, 5, 10, 15, 5]
STATS_MODS_UNFLAGGED = [0, 0, 0, 0, -5, -10, -15, -10]

def get_stats_mods(stats):
    stats_table_index = stats & 0x07
    stats_mods = []
    for i,stat_name in enumerate(STATS):
        if stats & (0x80 >> i):
            mod = STATS_MODS_FLAGGED[stats_table_index]
        else:
            mod = STATS_MODS_UNFLAGGED[stats_table_index]
        if mod:
            stats_mods.append( (stat_name, mod) )

    return stats_mods

item_equip_values = {}

used_equip_table_indices = set()
used_element_table_indices = set()

with open('PATH-TO-ROM', 'rb') as infile:
    infile.seek(0x7A590)
    elements_table = []
    for i in range(123):
        data = infile.read(3)
        elements_table.append(data[0] | (data[1] << 8) | (data[2] << 16))

    infile.seek(0x7A550)
    equip_table = []
    for i in range(32):
        data = infile.read(2)
        equip_table.append(data[0] | (data[1] << 8))

    for weapon_id,weapon_name in enumerate(WEAPONS):
        weapon_id += 1
        infile.seek(0x79100 + weapon_id * 0x08)
        data = infile.read(8)

        properties = data[0]
        attack = data[1]
        hit_rate = data[2]
        spell = data[3]
        elements = elements_table[data[4]]
        races = data[5]
        equip = data[6]
        stats = data[7]

        used_equip_table_indices.add(equip & 0x1F)
        used_element_table_indices.add(data[4])

        print(f'<{weapon_id:02X}> // {weapon_name}')

        print(f'  {attack}/{hit_rate & 0x7F}%')

        stats_mods = get_stats_mods(stats)
        if stats_mods:
            print('  ' + ' '.join([f'{m[0]}{m[1]:+}' for m in stats_mods]))

        if equip & 0x20:
            print(f'  Two-handed')
        equip = equip_table[equip & 0x1F]
        item_equip_values[weapon_id] = equip

        if properties & 0x20:
            print(f'  Long range')
        if properties & 0x40:
            print(f'  Throwable')
        if properties & 0x80:
            print(f'  Magnetic')

        if spell:
            print(f'  Casts {SPELLS[spell - 1]}')
        if elements & 0x40:
            print(f'  Absorbs HP')
            elements ^= 0x40
        if elements:
            element_names = [e for i,e in enumerate(ELEMENTS) if (elements & (0x01 << i))]
            print('  Inflicts ' + ', '.join(element_names))
        if races:
            race_names = [r for i,r in enumerate(RACES) if (races & (0x01 << i))]
            print('  Strong against ' + ', '.join(race_names))
        if equip:
            job_names = [j for i,j in enumerate(JOBS) if (equip & (0x01 << i))]
            print('  Usable by ' + ', '.join(job_names))

        print()

    for armor_id,armor_name in enumerate(ARMORS):
        armor_id += 0x61
        infile.seek(0x79100 + armor_id * 0x08)
        data = infile.read(8)

        magnetic = bool(data[0] & 0x80)
        magic_evade = data[0] & 0x7F
        physical_defense = data[1]
        physical_evade = data[2]
        magic_defense = data[3]
        elements = elements_table[data[4] & 0x3F]
        races = data[5]
        equip = equip_table[data[6] & 0x1F]
        stats = data[7]

        used_equip_table_indices.add(equip)
        used_element_table_indices.add(data[4] & 0x3F)

        item_equip_values[armor_id] = equip

        print(f'<{armor_id:02X}> // {armor_name}')

        print(f'  {physical_defense}/{physical_evade}, {magic_defense}/{magic_evade}')

        if magnetic:
            print('  Magnetic')

        stats_mods = get_stats_mods(stats)
        if stats_mods:
            print('  ' + ' '.join([f'{m[0]}{m[1]:+}' for m in stats_mods]))

        if elements:
            element_names = [e for i,e in enumerate(ELEMENTS) if (elements & (0x01 << i))]
            print('  Defends against ' + ', '.join(element_names))

        if races:
            race_names = [r for i,r in enumerate(RACES) if (races & (0x01 << i))]
            print('  Defends against ' + ', '.join(race_names))

        if equip:
            job_names = [j for i,j in enumerate(JOBS) if (equip & (0x01 << i))]
            print('  Usable by ' + ', '.join(job_names))

        print()

# create CSV values to put in item DB
for item_id in range(255):
    equip_value = item_equip_values.get(item_id, 0)
    fields = [str((equip_value >> i) & 1) for i in range(len(JOBS))]
    print(','.join(fields))

# check for unused table indices
print('UNUSED EQUIP TABLE ENTRIES: ' +
    ','.join([f'{b:02X}' for b in range(0x20) if b not in used_equip_table_indices])
    ) 
print('UNUSED ELEMENT TABLE ENTRIES: ' +
    ','.join([f'{b:02X}' for b in range(0x40) if b not in used_element_table_indices])
    ) 