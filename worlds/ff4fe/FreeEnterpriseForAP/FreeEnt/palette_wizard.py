import pkgutil

MAP_PALETTE_PAIRS = {
    'BaronTown' : [0x00, 0x01],
    'Mist' : [0x00, 0x09],
    'Kaipo' : [0x00, 0x05],
    'Mysidia' : [0x00, 0x01],
    'Silvera' : [0x00, 0x06],
    'ToroiaTown' : [0x00, 0x01],
    'Agart' : [0x00, 0x01],
    'ToroiaInn' : [0x00, 0x01],
    'ToroiaWeapon' : [0x00, 0x01],
    'ToroiaArmor' : [0x00, 0x01],
    'ToroiaItem' : [0x00, 0x01],
    'BaronInn' : [0x00, 0x01],
    'BaronEquipment' : [0x00, 0x01],
    'CidHouse' : [0x00, 0x01],
    'RosaHouse' : [0x00, 0x01],
    'RydiaHouse' : [0x00, 0x01],
    'KaipoInn' : [0x00, 0x01],
    'KaipoCafe' : [0x00, 0x01],
    'KaipoHospital' : [0x00, 0x05],
    'MysidiaCafe' : [0x00, 0x05],
    'MysidiaInn' : [0x00, 0x01],
    'MountOrdealsMirrorRoom' : [0x00, 0x01],
    'HouseOfWishes' : [0x00, 0x09],
    'RoomOfWishes' : [0x00, 0x01],
    'ToroiaCafe' : [0x00, 0x01],
    'ToroiaCafeUpstairs' : [0x00, 0x01],
    'ToroiaDancers' : [0x00, 0x01],
    'ToroiaDancers' : [0x00, 0x01],
    'ToroiaStable' : [0x00, 0x01],
    'ToroiaStableDownstairs' : [0x00, 0x08],
    'AstroTower' : [0x00, 0x01],
    'AstroTowerObservatory' : [0x00, 0x01],
    'AgartInn' : [0x00, 0x01],
    'BlackChocoboForest' : [0x02, 0x08],
    'TownWaterBG' : [0x00, 0x00],
    'CastleFloorBG' : [0x00, 0x01],
    'BaronCastle' : [0x00, 0x01],
    'Damcyan' : [0x00, 0x01],
    'Fabul' : [0x00, 0x09],
    'ToroiaCastle' : [0x00, 0x06],
    'Eblan' : [0x00, 0x01],
    'DesertBG' : [0x00, 0x00],
    'BaronCastleLobby' : [0x00, 0x01],
    'BaronCastleOuterCourt' : [0x00, 0x01],
    'BaronCastleThroneRoom' : [0x00, 0x01],
    'BaronCastleWestHall' : [0x00, 0x01],
    'BaronCastleEastHall' : [0x00, 0x01],
    'BaronCastlePrisonEntrance' : [0x00, 0x01],
    'BaronCastlePrison' : [0x00, 0x01],
    'BaronCastleSoldiersQuarters' : [0x00, 0x01],
    'BaronCastleWestTower1F' : [0x00, 0x01],
    'BaronCastleWestTower2F' : [0x00, 0x01],
    'BaronCastleCecilRoom' : [0x00, 0x01],
    'BaronCastleEastTower1F' : [0x00, 0x01],
    'BaronCastleEastTower2F' : [0x00, 0x01],
    'BaronCastleEastTower3F' : [0x00, 0x01],
    'BaronCastleEastTowerB1' : [0x00, 0x01],
    'BaronCastleOdinRoom' : [0x00, 0x01],
    'SewerEntrance' : [0x00, 0x01],
    'SewerB3' : [0x00, 0x01],
    'SewerB1' : [0x00, 0x01],
    'SewerSaveRoom' : [0x00, 0x01],
    'SewerB2' : [0x00, 0x01],
    'Damcyan1F' : [0x00, 0x01],
    'Damcyan2F' : [0x00, 0x01],
    'Damcyan3F' : [0x00, 0x01],
    'DamcyanTreasuryEntrance' : [0x00, 0x01],
    'DamcyanTreasuryDownstairs' : [0x00, 0x01],
    'RoomToSewer' : [0x00, 0x01],
    'AgartWeapon' : [0x00, 0x01],
    'AgartArmor' : [0x00, 0x01],
    'FabulLobby' : [0x00, 0x01],
    'FabulSecondFloor' : [0x00, 0x01],
    'FabulThroneRoom' : [0x00, 0x01],
    'FabulCrystalRoom' : [0x00, 0x04],
    'FabulEquipment' : [0x00, 0x01],
    'FabulInn' : [0x00, 0x01],
    'FabulEastTower1F' : [0x00, 0x01],
    'FabulEastTower2F' : [0x00, 0x01],
    'FabulKingRoom' : [0x00, 0x01],
    'FabulWestTower1F' : [0x00, 0x01],
    'FabulHospital' : [0x00, 0x01],
    'FabulYangRoom' : [0x00, 0x01],
    'FieldOutsideMist' : [0x00, 0x01],
    'WateryPassSaveRoom' : [0x00, 0x01],
    'ToroiaCastleLobby' : [0x00, 0x01],
    'ToroiaCastleClericRoom' : [0x00, 0x01],
    'ToroiaCastleCrystalRoom' : [0x00, 0x01],
    'ToroiaCastleHospital' : [0x00, 0x05],
    'ToroiaCastleStairs' : [0x00, 0x01],
    'ToroiaCastleHall' : [0x00, 0x01],
    'ToroiaCastlePotRoom' : [0x00, 0x01],
    'ToroiaCastleChestRoom' : [0x00, 0x01],
    'ToroiaCastleTreasury' : [0x00, 0x01],
    'Eblan1F' : [0x00, 0x01],
    'Eblan2F' : [0x00, 0x01],
    'EblanThroneRoom' : [0x00, 0x01],
    'EblanWestTower1F' : [0x00, 0x01],
    'EblanWestTower2F' : [0x00, 0x01],
    'EblanEastTower1F' : [0x00, 0x01],
    'EblanEastTower2F' : [0x00, 0x01],
    'EblanBasement' : [0x00, 0x01],
    'BaronCastleBlackMagicSchool' : [0x00, 0x01],
    'BaronCastleWhiteMagicSchool' : [0x00, 0x01],
    'DesertBG2' : [0x00, 0x01],
    'TrainingRoom' : [0x00, 0x01],
    'Waterfall' : [0x00, 0x05],
    'CastleWaterBG' : [0x00, 0x00],
    'MistCave' : [0x00, 0x01],
    'MirrorRoomBG' : [0x00, 0x00],
    'WateryPassBG' : [0x00, 0x00],
    'WateryPass1F' : [0x00, 0x01],
    'WateryPass2F' : [0x00, 0x01],
    'WateryPass3F' : [0x00, 0x01],
    'WateryPass4F' : [0x00, 0x01],
    'WateryPass5F' : [0x00, 0x01],
    'WaterfallEntrance' : [0x00, 0x05],
    'Waterfall1F' : [0x00, 0x05],
    'Waterfall2F' : [0x00, 0x05],
    'AntlionCave1F' : [0x00, 0x01],
    'AntlionCave2F' : [0x00, 0x01],
    'AntlionCaveNest' : [0x00, 0x08],
    'AntlionCaveSaveRoom' : [0x00, 0x01],
    'AntlionCaveTreasureRoom' : [0x00, 0x01],
    'BlackBG' : [0x00, 0x00],
    'MistBG' : [0x00, 0x00],
    'MountHobsWest' : [0x00, 0x05],
    'MountHobsSummit' : [0x00, 0x01],
    'MountHobsEast' : [0x00, 0x01],
    'MountHobsSave' : [0x00, 0x01],
    'MountainBG' : [0x00, 0x00],
    'WateryPassWaterfallRoom' : [0x00, 0x01],
    'MountOrdeals1F' : [0x00, 0x05],
    'MountOrdeals2F' : [0x00, 0x01],
    'MountOrdeals3F' : [0x00, 0x01],
    'MountOrdealsSummit' : [0x00, 0x01],
    'MysidiaCrystalRoom' : [0x00, 0x04],
    'MysidiaSerpentRoad' : [0x00, 0x01],
    'BaronCastleAntechamber' : [0x00, 0x07],
    'AgartWell' : [0x00, 0x01],
    'CaveMagnes1F' : [0x00, 0x01],
    'CaveMagnes2F' : [0x00, 0x01],
    'CaveMagnesPitTreasureRoom' : [0x00, 0x01],
    'CaveMagnes3F' : [0x00, 0x01],
    'CaveMagnesTorchTreasureRoom' : [0x00, 0x01],
    'CaveMagnes4F' : [0x00, 0x01],
    'CaveMagnesSaveRoom' : [0x00, 0x01],
    'CaveMagnes5F' : [0x00, 0x01],
    'CaveMagnesCrystalRoom' : [0x00, 0x04],
    'CaveMagnesBG' : [0x00, 0x00],
    'WateryPassCamp' : [0x00, 0x01],
    'BaronSerpentRoad' : [0x00, 0x01],
    'Zot1F' : [0x00, 0x01],
    'Zot2F' : [0x00, 0x01],
    'Zot3F' : [0x00, 0x01],
    'Black' : [0x00, 0x01],
    'Zot4F' : [0x00, 0x09],
    'Zot5F' : [0x00, 0x01],
    'Zot6F' : [0x00, 0x05],
    'ZotCommandCenter' : [0x00, 0x07],
    'AdamantGrotto' : [0x00, 0x01],
    'CaveMagnesSaveRoom2' : [0x00, 0x01],
    'ZotSaveRoom' : [0x00, 0x01],
    'CidAirship' : [0x00, 0x01],
    'TwinsAirship' : [0x00, 0x01],
    'EdwardAirship' : [0x00, 0x01],
    'BabilSaveRoom2' : [0x00, 0x01],
    'BabilB1' : [0x00, 0x01],
    'BabilB2' : [0x00, 0x01],
    'BabilB3' : [0x00, 0x01],
    'BabilB4' : [0x00, 0x01],
    'BabilCrystalRoom' : [0x00, 0x04],
    'BabilB5' : [0x00, 0x03],
    'FallingBG' : [0x00, 0x01],
    'UndergroundTunnelBG' : [0x00, 0x01],
    'CrystalRoomBG' : [0x00, 0x00],
    'EndingCecilRoom' : [0x00, 0x01],
    'TrainingRoomMain' : [0x00, 0x01],
    'TrainingRoomUpstairs' : [0x00, 0x01],
    'TrainingRoomUpstairs' : [0x00, 0x00],
    'TrainingRoomUpstairs' : [0x00, 0x00],
    'GiantMouth' : [0x00, 0x01],
    'GiantNeck' : [0x00, 0x01],
    'GiantChest' : [0x00, 0x01],
    'GiantChest' : [0x00, 0x00],
    'GiantStomach' : [0x00, 0x01],
    'GiantPassage' : [0x00, 0x01],
    'GiantPassage' : [0x00, 0x00],
    'GiantLung' : [0x00, 0x05],
    'GiantCPU' : [0x00, 0x01],
    'GiantBG' : [0x00, 0x00],
    'GiantBG' : [0x00, 0x00],
    'SoldierAirship' : [0x00, 0x01],
    'FabulPort' : [0x00, 0x01],
    'Boat' : [0x00, 0x05],
    'DockedAirship' : [0x00, 0x01],
    'JoinedAirships' : [0x00, 0x01],
    'EmptyAirship' : [0x00, 0x00],
    'UnderworldAirship' : [0x00, 0x01],
    'CaveEblanEntrance' : [0x00, 0x01],
    'CaveEblanSettlement' : [0x00, 0x01],
    'CaveEblanPass' : [0x00, 0x01],
    'CaveEblanExit' : [0x00, 0x01],
    'CaveEblanInn' : [0x00, 0x01],
    'CaveEblanEquipment' : [0x00, 0x01],
    'CaveEblanSaveRoom' : [0x00, 0x01],
    'CaveEblanHospital' : [0x00, 0x01],
    'FabulChocoboForest' : [0x02, 0x08],
    'EmptyAirship2' : [0x00, 0x01],
    'MountOrdealsChocoboForest' : [0x02, 0x08],
    'BaronChocoboForest' : [0x02, 0x08],
    'TroiaChocoboForest' : [0x02, 0x08],
    'IslandChocoboForest' : [0x02, 0x08],
    'BaronEmptyThroneRoom' : [0x00, 0x01],
    'EmptyAirshipBlack' : [0x00, 0x01],
    'EmptyAirship3' : [0x00, 0x01],
    'EmptyAirshipUnderground' : [0x00, 0x01],
    'EmptyAirshipBlack2' : [0x00, 0x01],
    'TowerOfWishesFinalBattle' : [0x00, 0x01],
    'AirshipBG' : [0x00, 0x00],
    'LargeDock' : [0x00, 0x00],
    'LargeDock' : [0x00, 0x00],
    'LargeDock' : [0x00, 0x00],
    'SmallDock' : [0x00, 0x00],
    'MistInn' : [0x00, 0x01],
    'MistWeapon' : [0x00, 0x01],
    'MistArmor' : [0x00, 0x01],
    'KaipoWeapon' : [0x00, 0x01],
    'KaipoArmor' : [0x00, 0x01],
    'MysidiaWeapon' : [0x00, 0x01],
    'MysidiaArmor' : [0x00, 0x01],
    'MysidiaItem' : [0x00, 0x01],
    'SilveraInn' : [0x00, 0x01],
    'SilveraWeapons' : [0x00, 0x06],
    'SilveraArmor' : [0x00, 0x01],
    'SilveraItems' : [0x00, 0x01],
    'BaronTownItems' : [0x00, 0x01],
    'EndingTowerOfWishes' : [0x00, 0x09],
    'EndingPalom' : [0x00, 0x01],
    'EndingEblan' : [0x00, 0x01],
    'EndingLeviathan' : [0x00, 0x01],
    'EndingDamcyan' : [0x00, 0x01],
    'EndingDwarfCastle' : [0x00, 0x01],
    'EndingMountOrdeals' : [0x00, 0x08],
    'EndingAstroTower' : [0x00, 0x01],
    'EndingCecilRoom2' : [0x00, 0x01],
    'EndingBaronThroneRoom' : [0x00, 0x01],
    'EndingFabulThroneRoom' : [0x00, 0x01],
    'EndingFabulThroneRoom' : [0x00, 0x00],
    'EndingFabulThroneRoom' : [0x00, 0x00],
    'EndingFabulThroneRoom' : [0x00, 0x00],
    'Overworld' : [0x00, 0x00],
    'Underworld' : [0x00, 0x00],
    'Moon' : [0x00, 0x00],
    'CurrentMap' : [0x00, 0x00],
    'CurrentMap' : [0x00, 0x00],
    'SmithyHouse' : [0x00, 0x01],
    'Tomra' : [0x00, 0x01],
    'SmithyHouseMainFloor' : [0x00, 0x01],
    'SmithyRoom' : [0x00, 0x01],
    'TomraInn' : [0x00, 0x01],
    'TomraEquipment' : [0x00, 0x01],
    'TomraTreasury' : [0x00, 0x01],
    'DwarfCastle' : [0x00, 0x01],
    'DwarfCastleLobby' : [0x00, 0x01],
    'DwarfCastleThroneRoom' : [0x00, 0x01],
    'DwarfCastleFatChocobo' : [0x00, 0x02],
    'DwarfCastleTunnel' : [0x00, 0x01],
    'CrystalRoomBG2' : [0x00, 0x00],
    'DwarfCastleCrystalRoom' : [0x00, 0x04],
    'DwarfCastleEquipment' : [0x00, 0x01],
    'DwarfCastleBasement' : [0x00, 0x01],
    'DwarfCastleEastTower1F' : [0x00, 0x01],
    'DwarfCastleInn' : [0x00, 0x01],
    'DwarfCastleHospital' : [0x00, 0x01],
    'DwarfCastleWestTower1F' : [0x00, 0x01],
    'BabilSaveRoom' : [0x00, 0x01],
    'BabilIcebrandRoom' : [0x00, 0x01],
    'BabilBlizzardRoom' : [0x00, 0x01],
    'BabilIceShieldRoom' : [0x00, 0x01],
    'BabilIceMailRoom' : [0x00, 0x01],
    'DwarfCastleEastTower3F' : [0x00, 0x01],
    'DwarfCastleWestTower3F' : [0x00, 0x01],
    'DwarfCastleTower2F' : [0x00, 0x01],
    'DwarfCastleBG' : [0x00, 0x00],
    'BabilFloorLugae' : [0x00, 0x01],
    'BabilFloorIceMail' : [0x00, 0x01],
    'BabilFloorAirship' : [0x00, 0x01],
    'DwarfCastleCafe' : [0x00, 0x01],
    'Babil1F' : [0x00, 0x06],
    'Babil2F' : [0x00, 0x01],
    'Babil3F' : [0x00, 0x01],
    'Babil4F' : [0x00, 0x01],
    'Babil5F' : [0x00, 0x01],
    'BabilFloorAirship2' : [0x00, 0x01],
    'BabilFloorIceMail2' : [0x00, 0x01],
    'BabilFloorLugae2' : [0x00, 0x03],
    'BabilFloorLugae2' : [0x00, 0x03],
    'BabilFloorLugae2' : [0x00, 0x01],
    'BabilFloorLugae2' : [0x00, 0x01],
    'BigWhale' : [0x00, 0x07],
    'BabilCannon' : [0x00, 0x09],
    'DwarfTank' : [0x00, 0x01],
    'BigWhale2' : [0x00, 0x02],
    'BabilBG' : [0x00, 0x00],
    'EndingPalom2' : [0x00, 0x01],
    'TomraItem' : [0x00, 0x00],
    'TowerOfWishesAfterGiant' : [0x00, 0x01],
    'CastleFloorBG2' : [0x00, 0x00],
    'TownWaterBG2' : [0x00, 0x00],
    'CaveOfSummons1F' : [0x00, 0x00],
    'CaveOfSummons2F' : [0x00, 0x00],
    'CaveOfSummons3F' : [0x00, 0x00],
    'SylvanCaveBG' : [0x00, 0x01],
    'Feymarch1F' : [0x00, 0x01],
    'FeymarchTreasury' : [0x00, 0x01],
    'Feymarch2F' : [0x00, 0x02],
    'FeymarchSaveRoom' : [0x00, 0x01],
    'FeymarchLibrary1F' : [0x00, 0x01],
    'FeymarchLibrary2F' : [0x00, 0x01],
    'FeymarchLeviathanRoom' : [0x00, 0x01],
    'FeymarchWeapon' : [0x00, 0x01],
    'FeymarchArmor' : [0x00, 0x01],
    'FeymarchInn' : [0x00, 0x02],
    'SealedCaveEntrance' : [0x00, 0x07],
    'SylvanCave1F' : [0x00, 0x00],
    'SylvanCave2F' : [0x00, 0x00],
    'SylvanCave3F' : [0x00, 0x00],
    'SylvanCaveTreasury' : [0x00, 0x00],
    'SylvanCaveYangRoom' : [0x00, 0x01],
    'SealedCave1F' : [0x00, 0x07],
    'SealedCaveRoomKatanaEther' : [0x00, 0x07],
    'SealedCave2F' : [0x00, 0x07],
    'SealedCave3F' : [0x00, 0x07],
    'SealedCaveRoomKatanaNinjaHat' : [0x00, 0x07],
    'SealedCaveRoomNinjaStarElixir' : [0x00, 0x07],
    'SealedCaveRoomLightSword' : [0x00, 0x07],
    'SealedCave4F' : [0x00, 0x07],
    'SealedCave5F' : [0x00, 0x07],
    'SealedCave6F' : [0x00, 0x07],
    'SealedCaveRoomBoxes' : [0x00, 0x07],
    'SealedCave7F' : [0x00, 0x07],
    'SealedCaveSaveRoom' : [0x00, 0x07],
    'SealedCaveDemonWallRoom' : [0x00, 0x07],
    'SealedCaveEmptyRoom' : [0x00, 0x07],
    'SealedCaveCrystalRoom' : [0x00, 0x04],
    'Bahamut1F' : [0x00, 0x00],
    'Bahamut2F' : [0x00, 0x00],
    'BahamutFloor' : [0x00, 0x03],
    'BahamutFloor' : [0x00, 0x00],
    'BahamutFloor' : [0x00, 0x00],
    'BahamutFloor' : [0x00, 0x00],
    'LunarPalaceLobby' : [0x00, 0x01],
    'LunarPalaceCrystalRoom' : [0x00, 0x04],
    'LunarBG' : [0x00, 0x01],
    'LunarPassage1' : [0x00, 0x01],
    'LunarPassage2' : [0x00, 0x01],
    'Hummingway' : [0x00, 0x01],
    'LunarLairBG' : [0x00, 0x00],
    'LunarSubterran1F' : [0x00, 0x01],
    'LunarSubterran2F' : [0x00, 0x01],
    'LunarSubterran3F' : [0x00, 0x01],
    'LunarSubterran4F' : [0x00, 0x01],
    'LunarSubterran5F' : [0x00, 0x01],
    'LunarSubterran6F' : [0x00, 0x01],
    'LunarSubterran7F' : [0x00, 0x01],
    'LunarCore1F' : [0x00, 0x01],
    'LunarCore2F' : [0x00, 0x01],
    'LunarCore3F' : [0x00, 0x01],
    'LunarCore4F' : [0x00, 0x01],
    'LunarCoreZemusRoom' : [0x00, 0x01],
    'LunarSubterranRoomElixir' : [0x00, 0x01],
    'LunarSubterranTunnelCure3' : [0x00, 0x01],
    'LunarSubterranTunnelProtectRing' : [0x00, 0x01],
    'LunarSubterranTunnelWhiteRobe' : [0x00, 0x01],
    'LunarSubterranPinkpuff' : [0x00, 0x01],
    'LunarSubterranSaveRoom1' : [0x00, 0x01],
    'LunarSubterranTunnelMinerva' : [0x00, 0x01],
    'LunarSubterranRoomHolyLance' : [0x00, 0x01],
    'LunarSubterranSaveRoom2' : [0x00, 0x01],
    'LunarSubterranRoomRibbons' : [0x00, 0x01],
    'LunarCoreBG' : [0x00, 0x00],
    'LunarCoreBG' : [0x00, 0x01],
    }

NPC_PALETTES = [
    [[0x00, 0x00, 0x00, 0x00, 0x7F, 0x32, 0xFB, 0x09, 0xFF, 0x7F, 0xFF, 0x1B, 0x1F, 0x21, 0x15, 0x00], 
     [0x00, 0x00, 0x00, 0x00, 0x7F, 0x32, 0xFB, 0x09, 0x7E, 0x0F, 0x55, 0x05, 0xC4, 0x7D, 0xA0, 0x64]], 
    [[0xB5, 0x56, 0x00, 0x00, 0x7F, 0x32, 0xFB, 0x09, 0x7E, 0x0F, 0x55, 0x05, 0x13, 0x68, 0x0B, 0x48], 
     [0x00, 0x00, 0x00, 0x00, 0xFF, 0x7F, 0xBD, 0x03, 0xFF, 0x56, 0xC0, 0x22, 0xC0, 0x7D, 0xC0, 0x01]], 
    [[0x00, 0x00, 0x00, 0x00, 0xFF, 0x7F, 0x7F, 0x02, 0x7F, 0x02, 0x79, 0x01, 0xFF, 0x2F, 0x4A, 0x29], 
     [0x00, 0x00, 0x00, 0x00, 0xFF, 0x7F, 0xFF, 0x7F, 0xDF, 0x57, 0x7F, 0x42, 0xFF, 0x7F, 0xFF, 0x7F]], 
    [[0x00, 0x00, 0x00, 0x00, 0xFF, 0x7F, 0x39, 0x47, 0x1F, 0x41, 0x7F, 0x2A, 0xF9, 0x01, 0x00, 0x58], 
     [0x00, 0x00, 0x00, 0x00, 0x7F, 0x32, 0xFB, 0x09, 0xFF, 0x7F, 0xFF, 0x1B, 0x13, 0x68, 0x0B, 0x48]], 
    [[0xB5, 0x56, 0x00, 0x00, 0xFF, 0x7F, 0xB8, 0x7F, 0x12, 0x7F, 0xAC, 0x7E, 0xE0, 0x7D, 0x20, 0x7D], 
     [0xB5, 0x56, 0x00, 0x00, 0xBD, 0x77, 0x52, 0x4A, 0x6B, 0x2D, 0x18, 0x1F, 0xEF, 0x09, 0x0E, 0x60]], 
    [[0xB5, 0x56, 0xFF, 0x7F, 0xBB, 0x7F, 0x58, 0x7F, 0xB4, 0x7E, 0x31, 0x7E, 0x8C, 0x7D, 0x08, 0x7D], 
     [0xB5, 0x56, 0x00, 0x00, 0xBF, 0x2A, 0x1A, 0x02, 0x13, 0x49, 0xDB, 0x1E, 0xFF, 0x73, 0xBA, 0x34]], 
    [[0x00, 0x00, 0x54, 0x01, 0xAF, 0x00, 0x4B, 0x00, 0x08, 0x00, 0x05, 0x00, 0x03, 0x00, 0x01, 0x00], 
     [0xB5, 0x56, 0x00, 0x00, 0x7D, 0x22, 0xD7, 0x01, 0x9F, 0x01, 0x2F, 0x27, 0x55, 0x05, 0xE6, 0x09]], 
    [[0xB5, 0x56, 0x00, 0x00, 0x7F, 0x32, 0x3B, 0x0A, 0xBA, 0x24, 0xB4, 0x12, 0xFF, 0x73, 0x8F, 0x6D], 
     [0x00, 0x00, 0x00, 0x00, 0xFF, 0x7F, 0xF7, 0x5E, 0x73, 0x4E, 0xEF, 0x3D, 0x6B, 0x2D, 0x08, 0x21]], 
    [[0xB5, 0x56, 0x00, 0x00, 0x5D, 0x22, 0xFF, 0x2B, 0x3F, 0x02, 0x4C, 0x7E, 0x74, 0x7F, 0x8C, 0x69], 
     [0x00, 0x00, 0x00, 0x00, 0xF7, 0x7E, 0x08, 0x7D, 0x1F, 0x02, 0x5D, 0x5D, 0xCE, 0x7D, 0x4A, 0x29]], 
    [[0x00, 0x00, 0xFF, 0x4B, 0x7F, 0x33, 0xBF, 0x1A, 0xFF, 0x01, 0x39, 0x01, 0x73, 0x00, 0x0C, 0x00], 
     [0x00, 0x00, 0xFF, 0x7F, 0xBE, 0x6B, 0x5B, 0x63, 0xF9, 0x56, 0x95, 0x46, 0x53, 0x46, 0x11, 0x36]], 
    [[0x00, 0x00, 0x00, 0x40, 0x00, 0x48, 0x00, 0x64, 0x80, 0x7C, 0x00, 0x64, 0x00, 0x48, 0x00, 0x40], 
     [0x00, 0x00, 0x00, 0x00, 0xD5, 0x7F, 0xFF, 0x03, 0xF4, 0x50, 0xBB, 0x7F, 0x93, 0x6E, 0xA5, 0x38]], 
    [[0x00, 0x00, 0x63, 0x10, 0xBC, 0x73, 0x29, 0x52, 0x86, 0x45, 0x05, 0x2D, 0x73, 0x00, 0x2E, 0x7E], 
     [0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]],
    ]

VINTAGE_NPC_PALETTES = [
    [[0x00, 0x00, 0x00, 0x00, 0x3C, 0x0E, 0x3C, 0x0E, 0xFF, 0x7F, 0x3C, 0x0E, 0x3C, 0x0E, 0x3C, 0x0E],
     [0x00, 0x00, 0x00, 0x00, 0x3C, 0x0E, 0x3C, 0x0E, 0x3C, 0x0E, 0x3C, 0x0E, 0x05, 0x7E, 0x05, 0x7E]],
    [[0xD6, 0x5A, 0x00, 0x00, 0x3C, 0x0E, 0x3C, 0x0E, 0x3C, 0x0E, 0x3C, 0x0E, 0x14, 0x6C, 0x14, 0x6C],
     [0x00, 0x00, 0x00, 0x02, 0x1F, 0x5B, 0x1F, 0x5B, 0x1F, 0x5B, 0x00, 0x02, 0x00, 0x7E, 0x00, 0x02]],
    [[0x00, 0x00, 0x00, 0x00, 0xFF, 0x7F, 0x9F, 0x02, 0x9F, 0x02, 0x9F, 0x02, 0x9F, 0x02, 0x00, 0x00],
     [0x00, 0x00, 0x00, 0x00, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0x9F, 0x4A, 0xFF, 0x7F, 0xFF, 0x7F]],
    [[0x00, 0x00, 0x00, 0x00, 0xFF, 0x7F, 0x9F, 0x32, 0x9F, 0x32, 0x9F, 0x32, 0x9F, 0x32, 0x00, 0x00],
     [0x00, 0x00, 0x0D, 0x50, 0x9F, 0x3A, 0x9F, 0x3A, 0xFF, 0x7F, 0x9F, 0x3A, 0x0D, 0x50, 0x0D, 0x50]],
    [[0xD6, 0x5A, 0x00, 0x00, 0xB9, 0x7F, 0xB9, 0x7F, 0xB9, 0x7F, 0x20, 0x7E, 0x20, 0x7E, 0x20, 0x7E],
     [0xD6, 0x5A, 0x00, 0x00, 0xBD, 0x77, 0xAD, 0x35, 0xAD, 0x35, 0xAD, 0x35, 0xAD, 0x35, 0xAD, 0x35]],
    [[0xD6, 0x5A, 0xBC, 0x7F, 0xBC, 0x7F, 0xBC, 0x7F, 0xD5, 0x7E, 0xD5, 0x7E, 0xCE, 0x7D, 0xCE, 0x7D],
     [0xD6, 0x5A, 0x00, 0x00, 0xFC, 0x26, 0xFC, 0x26, 0x54, 0x51, 0xFC, 0x26, 0xFC, 0x26, 0x54, 0x51]],
    [[0x00, 0x00, 0x95, 0x01, 0x6D, 0x00, 0x6D, 0x00, 0x6D, 0x00, 0x04, 0x00, 0x04, 0x00, 0x04, 0x00],
     [0xD6, 0x5A, 0x00, 0x00, 0x18, 0x02, 0x18, 0x02, 0x18, 0x02, 0x51, 0x2F, 0x18, 0x02, 0x51, 0x2F]],
    [[0xD6, 0x5A, 0x00, 0x00, 0x7C, 0x0E, 0x7C, 0x0E, 0x7C, 0x0E, 0x7C, 0x0E, 0xFF, 0x73, 0xFF, 0x73],
     [0x00, 0x00, 0x4A, 0x29, 0xFF, 0x7F, 0x94, 0x52, 0x94, 0x52, 0x94, 0x52, 0x4A, 0x29, 0x4A, 0x29]],
    [[0xD6, 0x5A, 0x00, 0x00, 0x9D, 0x2A, 0x9D, 0x2A, 0x9D, 0x2A, 0x8E, 0x7E, 0x8E, 0x7E, 0x8E, 0x7E],
     [0x00, 0x00, 0x00, 0x00, 0x10, 0x7E, 0x10, 0x7E, 0x5F, 0x02, 0x10, 0x7E, 0x10, 0x7E, 0x00, 0x00]],
    [[0x00, 0x00, 0xFF, 0x53, 0xFF, 0x53, 0xDF, 0x22, 0xDF, 0x22, 0x94, 0x00, 0x94, 0x00, 0x94, 0x00],
     [0x00, 0x00, 0xFF, 0x7F, 0x7C, 0x67, 0x7C, 0x67, 0x7C, 0x67, 0x94, 0x4E, 0x94, 0x4E, 0x94, 0x4E]],
    [[0x00, 0x00, 0x00, 0x48, 0x00, 0x48, 0x00, 0x68, 0xA0, 0x7C, 0x00, 0x68, 0x00, 0x48, 0x00, 0x48],
     [0x00, 0x00, 0xE7, 0x40, 0xD6, 0x7F, 0xFF, 0x03, 0xE7, 0x40, 0xD6, 0x7F, 0xD6, 0x7F, 0xE7, 0x40]],
    [[0x00, 0x00, 0x84, 0x14, 0xBC, 0x73, 0x6B, 0x56, 0x6B, 0x56, 0x84, 0x14, 0x84, 0x14, 0x6B, 0x56],
     [0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]]
    ]

class PaletteWizard:
    def __init__(self):
        self._assigned = {}
        self._name_map = {}


    def assign_npc_palette(self, src_pair, src_pair_subindex, index=None, priority=0, name=None, vintage=False):
        PALETTES = (VINTAGE_NPC_PALETTES if vintage else NPC_PALETTES)
        entry = PALETTES[src_pair][src_pair_subindex & 0x01]
        self.assign_custom_palette(entry, index, priority, name)

    def assign_custom_palette(self, entry, index=None, priority=0, name=None):
        if index is not None:
            if index not in self._assigned or self._assigned[index]['priority'] < priority:
                self._assigned[index] = {'data' : entry, 'priority' : priority}

            if name is not None:
                self._name_map[name] = index
        else:
            preexisting = False
            for i in self._assigned:
                if self._assigned[i]['data'] == entry:
                    preexisting = True
                    index = i
                    break

            if index is None:
                for i in range(4):
                    if i not in self._assigned:
                        index = i
                        break

            if index is None:
                min_priority_index = min(self._assigned, key=lambda i: self._assigned[i]['priority'])
                if self._assigned[min_priority_index]['priority'] < priority:
                    index = min_priority_index

            if index is not None:
                if preexisting:
                    self._assigned[index]['priority'] = max(self._assigned[index]['priority'], priority)
                else:
                    self._name_map = {k:self._name_map[k] for k in self._name_map if self._name_map[k] != index}
                    self._assigned[index] = {'data' : entry, 'priority' : priority}

                if name is not None:
                    self._name_map[name] = index

    def get_named_assignments(self):
        return self._name_map

    def get_data(self):
        data = []
        for i in range(4):
            if i in self._assigned:
                data.extend(self._assigned[i]['data'])
            else:
                data.extend([0x00] * 16)
        return data


if __name__ == '__main__':
    # do quick and dirty analysis to generate data for ourselves
    import re
    with pkgutil.get_data(__name__, "../f4c/dump.mapinfo.f4c") as infile:
        current_map = None
        for line in infile:
            m = re.search(r'^map\(#(?P<name>.*)\)', line)
            if m:
                current_map = m.group('name')
                continue

            m = re.search(r'npc palettes \$(..) \$(..)', line)
            if m:
                print("'{}' : [0x{}, 0x{}],".format(current_map, m.group(1), m.group(2)))
