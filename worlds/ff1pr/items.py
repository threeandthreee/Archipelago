from itertools import groupby
from typing import Dict, List, Set, NamedTuple, Optional
from BaseClasses import ItemClassification as IC


class FF1pixelItemData(NamedTuple):
    classification: IC
    quantity_in_item_pool: int
    item_id_offset: int
    item_qty: int

item_base_id = 398745498

item_table: Dict[str, FF1pixelItemData] = {
    "Leather Cap": FF1pixelItemData(IC.filler, 1, 175, 1),
    "Potion": FF1pixelItemData(IC.filler, 17, 2, 1),
    "Tent": FF1pixelItemData(IC.filler, 8, 18, 1),
    "Rune Blade": FF1pixelItemData(IC.filler, 1, 75, 1),
    "Werebuster": FF1pixelItemData(IC.filler, 1, 74, 1),
    "Gold Needle": FF1pixelItemData(IC.filler, 6, 14, 1),
    "Lute": FF1pixelItemData(IC.progression, 1, 45, 1),
    "Antidote": FF1pixelItemData(IC.filler, 6, 11, 1),
    "Jolt Tonic": FF1pixelItemData(IC.progression, 1, 48, 1),
    "Ship": FF1pixelItemData(IC.progression, 0, 44, 1), # set back to 1 when ready
    "Dagger": FF1pixelItemData(IC.filler, 1, 64, 1),
    "1180 Gil": FF1pixelItemData(IC.filler, 3, 1, 1180),
    "1120 Gil": FF1pixelItemData(IC.filler, 1, 1, 1120),
    "Broadsword": FF1pixelItemData(IC.filler, 1, 73, 1),
    "Phoenix Down": FF1pixelItemData(IC.filler, 2, 10, 1),
    "1045 Gil": FF1pixelItemData(IC.filler, 1, 1, 1045),
    "Cottage": FF1pixelItemData(IC.filler, 8, 19, 1),
    "Copper Armlet": FF1pixelItemData(IC.filler, 1, 156, 1),
    "Crown": FF1pixelItemData(IC.progression, 1, 46, 1),
    "1135 Gil": FF1pixelItemData(IC.filler, 1, 1, 1135),
    "Silver Armlet": FF1pixelItemData(IC.filler, 1, 157, 1),
    "1020 Gil": FF1pixelItemData(IC.filler, 2, 1, 1020),
    "Crystal Eye": FF1pixelItemData(IC.progression, 1, 47, 1),
    "Mythril Hammer": FF1pixelItemData(IC.filler, 1, 115, 1),
    "800 Gil": FF1pixelItemData(IC.filler, 1, 1, 800),
    "700 Gil": FF1pixelItemData(IC.filler, 1, 1, 700),
    "Bronze Gloves": FF1pixelItemData(IC.filler, 1, 192, 1),
    "Mystic Key": FF1pixelItemData(IC.progression, 1, 49, 1),
    "Falchion": FF1pixelItemData(IC.filler, 1, 97, 1),
    "Steel Gloves": FF1pixelItemData(IC.filler, 2, 193, 1),
    "Power Staff": FF1pixelItemData(IC.filler, 1, 120, 1),
    "Saber": FF1pixelItemData(IC.filler, 1, 72, 1),
    "Mythril Knife": FF1pixelItemData(IC.filler, 1, 65, 1),
    "Iron Armor": FF1pixelItemData(IC.filler, 1, 148, 1),
    "Nitro Powder": FF1pixelItemData(IC.progression, 1, 50, 1),
    "575 Gil": FF1pixelItemData(IC.filler, 3, 1, 575),
    "450 Gil": FF1pixelItemData(IC.filler, 2, 1, 450),
    "Excalibur": FF1pixelItemData(IC.useful, 1, 92, 1),
    "Great Helm": FF1pixelItemData(IC.filler, 1, 185, 1),
    "Wyrmkiller": FF1pixelItemData(IC.filler, 1, 76, 1),
    "Ether": FF1pixelItemData(IC.filler, 2, 5, 1),
    "Mythril Mail": FF1pixelItemData(IC.filler, 1, 147, 1),
    "1975 Gil": FF1pixelItemData(IC.filler, 2, 1, 1975),
    "795 Gil": FF1pixelItemData(IC.filler, 1, 1, 795),
    "880 Gil": FF1pixelItemData(IC.filler, 1, 1, 880),
    "Leather Shield": FF1pixelItemData(IC.filler, 1, 161, 1),
    "5000 Gil": FF1pixelItemData(IC.filler, 5, 1, 5000),
    "Coral Sword": FF1pixelItemData(IC.filler, 1, 77, 1),
    "330 Gil": FF1pixelItemData(IC.filler, 1, 1, 330),
    "Sleeping Bag": FF1pixelItemData(IC.filler, 2, 17, 1),
    "3400 Gil": FF1pixelItemData(IC.filler, 4, 1, 3400),
    "Star Ruby": FF1pixelItemData(IC.progression, 1, 53, 1),
    "Staff": FF1pixelItemData(IC.filler, 2, 118, 1),
    "1520 Gil": FF1pixelItemData(IC.filler, 4, 1, 1520),
    "5450 Gil": FF1pixelItemData(IC.filler, 3, 1, 5450),
    "1455 Gil": FF1pixelItemData(IC.filler, 4, 1, 1455),
    "Mythril Shield": FF1pixelItemData(IC.filler, 2, 164, 1),
    "1250 Gil": FF1pixelItemData(IC.filler, 3, 1, 1250),
    "Great Axe": FF1pixelItemData(IC.filler, 1, 107, 1),
    "620 Gil": FF1pixelItemData(IC.filler, 1, 1, 620),
    "Mythril Helm": FF1pixelItemData(IC.filler, 4, 187, 1),
    "Earth Rod": FF1pixelItemData(IC.progression, 1, 54, 1),
    "Canoe": FF1pixelItemData(IC.progression, 1, 61, 1),
    "Clothes": FF1pixelItemData(IC.filler, 2, 134, 1),
    "Flame Sword": FF1pixelItemData(IC.useful, 1, 83, 1),
    "Levistone": FF1pixelItemData(IC.progression, 1, 55, 1),
    "Ice Armor": FF1pixelItemData(IC.useful, 1, 149, 1),
    "Mythril Gloves": FF1pixelItemData(IC.filler, 2, 197, 1),
    "7900 Gil": FF1pixelItemData(IC.filler, 3, 1, 7900),
    "9900 Gil": FF1pixelItemData(IC.filler, 4, 1, 9900),
    "5454 Gil": FF1pixelItemData(IC.filler, 1, 1, 5454),
    "12350 Gil": FF1pixelItemData(IC.filler, 3, 1, 12350),
    "10000 Gil": FF1pixelItemData(IC.filler, 3, 1, 10000),
    "9500 Gil": FF1pixelItemData(IC.filler, 3, 1, 9500),
    "Ice Shield": FF1pixelItemData(IC.useful, 1, 165, 1),
    "Healing Staff": FF1pixelItemData(IC.useful, 1, 119, 1),
    "Ruby Armlet": FF1pixelItemData(IC.filler, 1, 158, 1),
    "Ice Brand": FF1pixelItemData(IC.useful, 2, 86, 1),
    "7340 Gil": FF1pixelItemData(IC.filler, 3, 1, 7340),
    "Gauntlets": FF1pixelItemData(IC.filler, 1, 194, 1),
    "Rat's Tail": FF1pixelItemData(IC.progression, 1, 57, 1),
    "2750 Gil": FF1pixelItemData(IC.filler, 6, 1, 2750),
    "2000 Gil": FF1pixelItemData(IC.filler, 3, 1, 2000),
    "X-Potion": FF1pixelItemData(IC.useful, 1, 4, 1),
    "Elixir": FF1pixelItemData(IC.useful, 3, 8, 1),
    "1000 Gil": FF1pixelItemData(IC.filler, 1, 1, 1000),
    "Dry Ether": FF1pixelItemData(IC.filler, 2, 7, 1),
    "Great Sword": FF1pixelItemData(IC.filler, 1, 79, 1),
    "4150 Gil": FF1pixelItemData(IC.filler, 4, 1, 4150),
    "1295 Gil": FF1pixelItemData(IC.filler, 1, 1, 1295),
    "Hi-Potion": FF1pixelItemData(IC.filler, 1, 3, 1),
    "1760 Gil": FF1pixelItemData(IC.filler, 3, 1, 1760),
    "Mythril Axe": FF1pixelItemData(IC.filler, 1, 109, 1),
    "1380 Gil": FF1pixelItemData(IC.filler, 2, 1, 1380),
    "Flame Shield": FF1pixelItemData(IC.useful, 1, 166, 1),
    "1150 Gil": FF1pixelItemData(IC.filler, 2, 1, 1150),
    "1155 Gil": FF1pixelItemData(IC.filler, 1, 1, 1155),
    "Flame Mail": FF1pixelItemData(IC.useful, 1, 150, 1),
    "Wizard's Staff": FF1pixelItemData(IC.filler, 1, 123, 1),
    "Ribbon": FF1pixelItemData(IC.useful, 3, 183, 1),
    "6400 Gil": FF1pixelItemData(IC.filler, 2, 1, 6400),
    "13450 Gil": FF1pixelItemData(IC.filler, 1, 1, 13450),
    "Defender": FF1pixelItemData(IC.useful, 1, 87, 1),
    "Warp Cube": FF1pixelItemData(IC.progression, 1, 58, 1),
    "Oxyale": FF1pixelItemData(IC.progression, 1, 60, 1),
    "Diamond Armor": FF1pixelItemData(IC.useful, 1, 153, 1),
    "1300 Gil": FF1pixelItemData(IC.filler, 2, 1, 1300),
    "Light Axe": FF1pixelItemData(IC.useful, 2, 110, 1),
    "Mage's Staff": FF1pixelItemData(IC.useful, 1, 121, 1),
    "9000 Gil": FF1pixelItemData(IC.filler, 2, 1, 9000),
    "Diamond Armlet": FF1pixelItemData(IC.useful, 1, 160, 1),
    "Diamond Shield": FF1pixelItemData(IC.useful, 2, 168, 1),
    "Diamond Gloves": FF1pixelItemData(IC.useful, 2, 198, 1),
    "Diamond Helm": FF1pixelItemData(IC.useful, 1, 188, 1),
    "Rosetta Stone": FF1pixelItemData(IC.progression, 1, 52, 1),
    "1110 Gil": FF1pixelItemData(IC.filler, 1, 1, 1110),
    "1450 Gil": FF1pixelItemData(IC.filler, 1, 1, 1450),
    "8135 Gil": FF1pixelItemData(IC.filler, 3, 1, 8135),
    "7690 Gil": FF1pixelItemData(IC.filler, 1, 1, 7690),
    "Giant's Gloves": FF1pixelItemData(IC.useful, 1, 195, 1),
    "1385 Gil": FF1pixelItemData(IC.filler, 1, 1, 1385),
    "Chime": FF1pixelItemData(IC.progression, 1, 56, 1),
    "Healing Helm": FF1pixelItemData(IC.useful, 2, 186, 1),
    "18010 Gil": FF1pixelItemData(IC.filler, 1, 1, 18010),
    "Vorpal Sword": FF1pixelItemData(IC.useful, 1, 82, 1),
    "Aegis Shield": FF1pixelItemData(IC.useful, 1, 170, 1),
    "Thor's Hammer": FF1pixelItemData(IC.useful, 1, 116, 1),
    "13000 Gil": FF1pixelItemData(IC.filler, 2, 1, 13000),
    "7600 Gil": FF1pixelItemData(IC.filler, 1, 1, 7600),
    "Sun Blade": FF1pixelItemData(IC.useful, 1, 89, 1),
    "Dragon Mail": FF1pixelItemData(IC.useful, 1, 154, 1),
    "Razer": FF1pixelItemData(IC.useful, 1, 80, 1),
    "6720 Gil": FF1pixelItemData(IC.filler, 1, 1, 6720),
    "Protect Ring": FF1pixelItemData(IC.useful, 3, 202, 1),
    "Black Robe": FF1pixelItemData(IC.useful, 1, 137, 1),
    "White Robe": FF1pixelItemData(IC.useful, 1, 136, 1),
    "Adamantite": FF1pixelItemData(IC.progression, 1, 51, 1),
    "Protect Cloak": FF1pixelItemData(IC.useful, 2, 173, 1),
    "Sasuke's Blade": FF1pixelItemData(IC.useful, 2, 100, 1),
    "Masamune": FF1pixelItemData(IC.useful, 1, 103, 1),
    "Bottled Faerie": FF1pixelItemData(IC.progression, 1, 59, 1),
    "All Promotion Jobs": FF1pixelItemData(IC.useful, 0, 500, 1),
    "Knight Job": FF1pixelItemData(IC.useful, 0, 501, 1),
    "Ninja Job": FF1pixelItemData(IC.useful, 0, 502, 1),
    "Master Job": FF1pixelItemData(IC.useful, 0, 503, 1),
    "Red Wizard Job": FF1pixelItemData(IC.useful, 0, 504, 1),
    "White Wizard Job": FF1pixelItemData(IC.useful, 0, 505, 1),
    "Black Wizard Job": FF1pixelItemData(IC.useful, 0, 506, 1),
}

#{name: location_base_id + index for index, name in enumerate(location_table)}
item_name_to_id: Dict[str, int] = {name: item_base_id + index for index, name in enumerate(item_table)}

filler_items: List[str] = [name for name, data in item_table.items() if data.classification == IC.filler]

item_name_groups: Dict[str, Set[str]] = {
    "Gil": {key for key, value in item_table.items() if value.item_id_offset == 1},
    "Consumables": {key for key, value in item_table.items() if ((value.item_id_offset > 1) and (value.item_id_offset < 37))},
    "Key Items": {key for key, value in item_table.items() if ((value.item_id_offset > 43) and (value.item_id_offset < 62))},
    "Weapons": {key for key, value in item_table.items() if ((value.item_id_offset > 62) and (value.item_id_offset < 130))},
    "Armors": {key for key, value in item_table.items() if ((value.item_id_offset > 133) and (value.item_id_offset < 203))},
    "Jobs": {key for key, value in item_table.items() if ((value.item_id_offset >= 501) and (value.item_id_offset < 507))},
    "Fillers": {key for key, value in item_table.items() if value.classification == IC.filler},
}
